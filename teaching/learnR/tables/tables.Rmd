---
title: "Tables in R"
author: "James Scott"
date: "4/20/2021"
output:
  github_document:
    includes:
      in_header: header.md
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Learning goals

Key R functions and concepts:  

- `xtabs`
- `prop.table`
- `addmargins`
- piping (`%>%`)  

## The data

Before you get started, download [aclfest.csv](http://jgscott.github.io/teaching/data/aclfest.csv), which contains data on the bands that played at several major U.S. music festivals (including our our ACL Festival here in Austin).  

## Getting started

We'll first load the [tidyverse library](https://www.tidyverse.org/). 

```{r}
library(tidyverse)
```

If you haven't installed the tidyverse library, this will give you an error.  To avoid the error, you'll need to install `tidyverse` using the `Install` button under the Packages tab, which is typically located in the bottom-right panel of RStudio's four-panel layout.

Then use the `Import Dataset` button, which you can find under the `Environment` tab in the top-right panel.  Follow the prompts to import aclfest.csv.

For a reminder on how to accomplish these key steps of loading a library and importing a data set, see the previous walkthrough on [Getting Started in R]().  

```{r, echo=FALSE, message=FALSE}
aclfest = read.csv('../../data/aclfest.csv')
```

## Simple probabilities from tables

Let's make a few simple tables with this data.  This will allow us to estimate probabilities like:  

1. How likely is a band in this sample to play Lollapalooza?  
2. How likely is a band to play ACL Fest, given that they played Lollapalooza?  
3. How like is a band to play either ACL _or_ Lollapalooza?  


Let's address question 1: what is P(played Lollapalooza) for a randomly selected band in this sample?

To answer this, we'll use R's `xtabs` function to tabulate the data according to whether a band played Lollapalooza (1) or not (0).  

```{r}
xtabs(~lollapalooza, data=aclfest)
```

Remember, 1 means yes.  So of the 1238 bands (800 + 438) in this sample, 438 of them played Lollapalooza.  We can now just use R as a calculator to get this proportion:

```{r}
438/(800 + 438)
```

But we can also get R to turn those counts into proportions for us, using the `prop.table` function.  One way to do this is as follows.  First we'll make the same table as before, except now we'll save the result in an "object" whose name we get to choose.  We'll just call it `t1` here, although you could call it something more imaginative if you wanted to.  

```{r}
t1 = xtabs(~lollapalooza, data=aclfest)
```

Remember one of the core ideas in programming: chaining computations together.    That's exactly what we're doing here: we'll take this `t1` object we've created (the first link our chain) and pass it into the `prop.table` function (the second link in our chain).  This function turns a table of counts (like `t1`) into a table of proportions, like this:

```{r}
prop.table(t1)
```


Here's a nicer way to do this, using a "pipe" (`%>%`):
```{r}
xtabs(~lollapalooza, data=aclfest) %>%
  prop.table
```

This code block says: "make a table of counts of the `lollapalooza` variable in the `aclfest` data set, and pipe the resulting table into `prop.table` to turn the table of counts into a table of proportions."

The result is exactly the same as before, when we first created an "intermediate" table called t1, but there are some good reasons to use the "piped" version.



<!-- # Q2: what is P(played ACL | played Lollapalooza)? -->
<!-- # A: cross tabulate the data by both festivals -->
<!-- xtabs(~acl + lollapalooza, data=aclfest) -->

<!-- # As before, we can treat R just like a calculator... -->

<!-- # how many bands played lollapalooza? -->
<!-- # (we actually knew this from the previosu calculuation, -->
<!-- # but pretend we didn't.) -->
<!-- 77+361 -->

<!-- # of those 438 bands, how many also played ACL? -->
<!-- 77/438 -->

<!-- # save the table in an "object" whose name we get to choose. -->
<!-- t2 = xtabs(~acl + lollapalooza, data=aclfest) -->
<!-- my_table -->

<!-- # Turn counts into proportions. -->
<!-- # This makes the whole table sum to 1. -->
<!-- prop.table(my_table) -->

<!-- # It's often easier to organize your steps using "pipes". -->
<!-- # Here we "pipe" the table of counts into the "prop.table" function -->
<!-- xtabs(~acl + lollapalooza, data=aclfest) %>% -->
<!--   prop.table -->

<!-- # You can add further steps in the pipeline. -->
<!-- # For example, "addmargins" adds the sum of each row and column. -->
<!-- xtabs(~acl + lollapalooza, data=aclfest) %>% -->
<!--   prop.table %>% -->
<!--   addmargins -->

<!-- # We can add an optional "flag" to prop.table to get conditional probabilities. -->
<!-- # Here we condition on the second variable (margin=2), which is lollapalooza. -->
<!-- # This makes the columns sum to 1. -->
<!-- xtabs(~acl + lollapalooza, data=aclfest) %>% -->
<!--   prop.table(margin=2) -->
<!-- # Concusion: P(ACL = 1 | Loll = 1) = 0.176 -->
<!-- # This is exactly what we calculated "by hand." -->

<!-- # Add a step in the pipeline to round to three decimal places. -->
<!-- xtabs(~acl + lollapalooza, data=aclfest) %>% -->
<!--   prop.table(margin=2) %>% -->
<!--   round(3) -->
